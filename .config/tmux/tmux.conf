# ===== TMUX CONFIGURATION =====

# Change prefix from Ctrl+b to Ctrl+a (easier to reach)
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# Enable mouse support
set -g mouse on

# Start windows and panes at 1, not 0
set -g base-index 1
setw -g pane-base-index 1

# Increase history limit
set -g history-limit 10000

# Enable 256 colors
set -g default-terminal "screen-256color"

# Faster command sequences
set -s escape-time 0

# ===== KEY BINDINGS =====

# Split panes using | and -
bind | split-window -h
bind - split-window -v
unbind '"'
unbind %

# Reload config file
# bind r source-file ~/.tmux.conf \; display "Config reloaded!"
bind r source-file ~/.config/tmux/tmux.conf

# Switch panes using Alt+arrow without prefix
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# ===== POPUP WINDOWS =====

# Quick terminal popup (prefix + g)
bind g display-popup -E -w 80% -h 80%

# Git status popup (prefix + Shift+G)
bind G display-popup -E -w 80% -h 80% -d "#{pane_current_path}" "git status && echo '' && git log --oneline -10 && read -p 'Press enter to close'"

# System monitor popup (prefix + m)
bind m display-popup -E -w 80% -h 80% "htop"

# File browser popup with lf/ranger if available, otherwise ls (prefix + f)
bind f display-popup -E -w 80% -h 80% -d "#{pane_current_path}" "command -v lf >/dev/null 2>&1 && lf || command -v ranger >/dev/null 2>&1 && ranger || (ls -lah && read -p 'Press enter to close')"

# ===== LOGGING CONFIGURATION =====

# Toggle logging on/off with prefix + Shift+P
# This will save everything displayed in the pane to a file
bind-key P pipe-pane -o "cat >> ~/Documents/learning/tmux-logs/tmux-session-#S-#I-#P-%Y%m%d-%H%M%S.log" \; display-message "Logging toggled"

# Capture pane history to file with prefix + Shift+H
bind-key H command-prompt -p 'save history to filename:' -I '~/Documents/learning/tmux-logs/tmux-history.txt' 'capture-pane -S - -E - ; save-buffer %1 ; delete-buffer'

# ===== STATUS BAR =====

# Status bar layout
set -g status-left '[#S] '
set -g status-right '#{?pane_pipe,üìù LOGGING ,}| %H:%M %d-%b-%y'
set -g status-right-length 50
set -g status-left-length 20

# Window format
setw -g window-status-current-format ' #I:#W#F '
setw -g window-status-format ' #I:#W#F '

# Source theme colors (symlink to dark.conf or light.conf)
source-file ~/.config/tmux/themes/theme.conf

# ===== NOTES =====
# Logging indicator: When logging is active, you'll see üìù LOGGING in the status bar
# Log files are saved to: ~/Documents/learning/tmux-logs/
